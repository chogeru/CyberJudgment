# VolFx
[![Twitter](https://img.shields.io/badge/Follow-Twitter?logo=twitter&color=white)](https://twitter.com/NullTale)
[![Discord](https://img.shields.io/badge/Discord-Discord?logo=discord&color=white)](https://discord.gg/CkdQvtA5un)
[![Boosty](https://img.shields.io/badge/Support-Boosty?logo=boosty&color=white)](https://boosty.to/nulltale)
[![Forum](https://img.shields.io/badge/Forum-asd?logo=ChatBot&color=blue)](https://forum.unity.com/threads/1542860)
[![Asset Store](https://img.shields.io/badge/Asset%20Store-asd?logo=Unity&color=red)](https://assetstore.unity.com/packages/tools/particles-effects/volfx-270928)

VolFx is selective post-processing for Unity Urp<br>
designed for visual effects creation âœ¨

Tested with 2022.2, 2023.2 Web (2021 not supported)

* extended version on the [AssetStore](https://assetstore.unity.com/packages/tools/particles-effects/volfx-270928)
* visual effect can be controlled via timeline using [ScreenFx](https://assetstore.unity.com/packages/tools/camera/270814)
* can use effects from [PostArt](https://github.com/NullTale/PixelationFx) project as render passes

## Features
* Custom passes - expandable, has minimal set of custom effects and generic blit feature
* Selective post processing - can be applied to scene objects by layer mask
* Downlodable art effects - all effects from [PostArt](https://github.com/NullTale/PixelationFx) projects can be added as passes to VolFx without cluttering RenderFeature list
* Volume control - all build in effects controlled via volume profile and linked to a layer mask, so scene processing can be easily made dynamic
* Buffer system - can render object to a buffer texture to provide additional textures(like light maps, pattern animations, height etc) then process and use them later through a shader
* Configurable pipeline - each effect can be reordered and configured depending on the application

----------------------------------------- - - - - -  -  - <br>

#### Selective post processing
Visual novel example, post processing applyed to scene objects by LayerMask to blur the background and fade character sprite<br>
Thus you can make the appearance effect or apply graphical changes separately to scene objects <br>

![_Cover](https://github.com/NullTale/VolFx/assets/1497430/a1f99548-8bc8-43fb-93ba-0668f9a46ef9)<br>

#### Work with 3D
Selective application to a 3D object with depth buffer support

![_cover](https://github.com/NullTale/VolFx/assets/1497430/58f6af02-83ae-4b1a-9f3c-9d995229c02f)

#### Custom texture processing
There is an example of light texture post processing generated by [GiLight2D](https://github.com/NullTale/GiLight2D)<br>
Volume control allows to tweack texture at runtime to achive desiared light visualization<br>

![_Light](https://github.com/NullTale/VolFx/assets/1497430/2bed6140-1b82-41a6-8b9d-adc991334e3c)<br>


#### Extended [AssetStore](https://assetstore.unity.com/packages/tools/particles-effects/270928) store version

Additional custom passets and option to support the project

![_cover](https://github.com/NullTale/VolFx/assets/1497430/13c87450-24a7-4d17-848c-692bd33486d2)

#### Fx creation via timeline using [ScreenFx](https://assetstore.unity.com/packages/tools/camera/270814)
Timeline clip editing using post processing effects

![_ScreenFxCover](https://github.com/NullTale/VolFx/assets/1497430/cb89b908-ee2b-4716-ac14-3411968fe92e)

#### Editor workflow
Selective application and customizable effects sequence<br>

![_cover](https://github.com/NullTale/VolFx/assets/1497430/22b67d1c-80fd-4a24-8980-2b7e0bea6a79)<br>

## Install and usage
Install via Unity [PackageManager](https://docs.unity3d.com/Manual/upm-ui-giturl.html) <br>
```
https://github.com/NullTale/VolFx.git
```

---

Add `VolFxProc` feature to UrpRenderer add post-process passes to it, control via volume profile <br>

![_Urp](https://github.com/NullTale/VolFx/assets/1497430/21dda2ff-c82e-4d46-8335-d542fc53428c) <br>
<sup>* optionally configure the render event, source with output and volume mask</sup>

If  use `LayerMask` as a source you need to exclude objects redering by [filtering](https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@14.0/manual/urp-universal-renderer.html#filtering) option in UrpRenderer asset to prevent twice rendering <br>(objects will be rendered by VolFx)

`VolFxBuffers` feature can be used to collect specific object to a texture to provide some texture source<br>
that can be post processed at runtime and used later throug a shader as a texture or screen space mask for selective application

![image](https://github.com/NullTale/VolFx/assets/1497430/9288c212-c6c2-486b-b699-940eacc11a53)

Example of global texture accessed via shader graph (name match, no exposed checkbox)

![image](https://github.com/NullTale/VolFx/assets/1497430/2b99bebc-cc9c-4d1c-ae5d-2ada10f9be1f)


## Build in Effects

VolFx was built to be highly configurable and most of the effects are powerful in their [combination](https://twitter.com/NullTale/status/1693158627442364490) <br>
There can be a number of custom `Blit` passes controlled via material for easy effect implementation.

#### Extended Color Adjustments
With the curve you can adjust the range on which part of the image to apply Color Adjustement <br>
Other option are classic exept the alpha channel that used to adjust alpha chennel to blend images properly <br>

![Adjustments](https://github.com/NullTale/VolFx/assets/1497430/af84b49d-22c3-47fd-a315-d4e8f7b35ac9)

#### Bloom
Threshold controlled by curve, color made with gradient(support blending) <br>
Also has some advanved options in effect pass like flickering, samples count and scuttering curve. <br>
Basically extended remplementation of moust popular effect to process the images <br>

![Bloom](https://github.com/NullTale/VolFx/assets/1497430/12475cb3-ab40-4e89-a3ac-6730155ed075)

#### Blur
Blur with radial and distortion options

![Blur](https://github.com/NullTale/VolFx/assets/1497430/28b6a7ab-1eae-4053-8088-99a20cc9a6b3)

#### Mask
Post processing mask from scene objects with alpha support

![_mask](https://github.com/NullTale/VolFx/assets/1497430/c0f1ac92-03f2-485a-a8c0-308af901af29)



## Custom Effect

There is an example of simple grayscale effect that can be found in `Project Samples`

![_cover](https://github.com/NullTale/VolFx/assets/1497430/9670cfd8-563e-4283-bb9f-b4c221242bd1)

All effect must be inherated from `VolFxProc.Pass` and then added to a `VolFxRenderFeature` <br>
Material creates automatically using `ShaderName` attribute, `VolumeSettings` implemented using [Unity API](https://docs.unity3d.com/Packages/com.unity.render-pipelines.core@7.1/api/UnityEngine.Rendering.VolumeComponent.html)

```C#
[ShaderName("Hidden/VolFx/Grayscale")] // shader name for pass material
public class GrayscalePass : VolFxProc.Pass
{
    // =======================================================================
    public override bool Validate(Material mat)
    {
        // use stack from feature settings, feature use custom VolumeStack with its own LayerMask
        var settings = Stack.GetComponent<GrayscaleVol>();
        
        // return false if we don't want to execute pass, standart check
        if (settings.IsActive() == false)
            return false;
        
        // setup material before drawing
        mat.SetFloat("_Weight", settings.m_Weight.value);
        return true;
    }
}
```
Grayscale shader
```C#
Shader "Hidden/VolFx/Grayscale" // name of the shader for ShaderNameAttribute
...

half luma(half3 rgb)
{
    return dot(rgb, half3(0.299, 0.587, 0.114));
}

frag_in vert(const vert_in v)
{
    frag_in o;
    o.vertex = v.vertex;
    o.uv = v.uv;
    return o;
}

half4 frag(const frag_in i) : SV_Target
{
    half4 main = tex2D(_MainTex, i.uv);
    half4 col  = luma(main.rgb);
    
    return half4(lerp(main.rgb, luma(col.rgb), _Weight), main.a);
}
```
Feature work as a wrapper but can be extended by override low level methods, to gain access to a CommandBuffer and other rendering API stuff<br>
```C#
/// called to perform rendering
public virtual void Invoke(CommandBuffer cmd, RTHandle source, RTHandle dest,
                           ScriptableRenderContext context, ref RenderingData renderingData)
{
    Utils.Blit(cmd, source, dest, _material, 0, Invert);
}
```

## PostArt

More effects can be [downloaded](https://github.com/NullTale/PixelationFx) separately for use in combination<br>
If `VolFx` is installed they will work as part of the framework and will not appear in the RenderFeature list
  
Effects applied sequentially to a 3D object

![_cover](https://github.com/NullTale/VolFx/assets/1497430/38b7fa20-84f6-4717-bc26-cd1333c749bf)<br>

* [Pixelation](https://github.com/NullTale/PixelationFx/)
* [VHS](https://github.com/NullTale/VhsFx)
* [ScreenOutline](https://github.com/NullTale/OutlineFilter)
* [ImageFlow](https://github.com/NullTale/FlowFx)
* [OldMovie](https://github.com/NullTale/OldMovieFx)
* [GradientMap](https://github.com/NullTale/GradientMapFilter)
* [Ascii](https://github.com/NullTale/AsciiFx)
* [Dither](https://github.com/NullTale/DitherFx)
